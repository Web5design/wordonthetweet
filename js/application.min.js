(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;t=function(){function e(e){var t=this;this.afinn={},this.queue=[],this.running=!1,this.ready=!1,$.get(e,function(e){var n,r,i,s,o,u,a;r=e.split("\n");for(o=0,u=r.length;o<u;o++)n=r[o],a=n.split("	"),s=a[0],i=a[1],t.afinn[s]=parseInt(i);return t.ready=!0,t.work()})}return e.prototype.addToQueue=function(e,t,n){this.queue.push({text:e,metadata:t,callback:n});if(!this.running&&this.ready)return this.work()},e.prototype.analyze=function(e,t,n){var r,i,s,o,u,a,f,l,c,h;a=e.toLowerCase().split(/\W+/),i=[];for(f=0,c=a.length;f<c;f++)u=a[f],this.afinn[u]!==void 0&&i.push(this.afinn[u]);o=0;for(l=0,h=i.length;l<h;l++)r=i[l],o+=r;return s=Math.sqrt(i.length),n(e,t,o/s)},e.prototype.work=function(){var e;this.running=!0;while(this.queue.length>0)e=this.queue.shift(),this.analyze(e.text,e.metadata,e.callback);return this.running=!1},e}(),b=20,r=150,e="AFINN-111-emo.txt",g="#stream-holder",m=".stream",u="#options",o="#options-columns",i="#options-add-btn",a="#options-done-btn",f="#options-errors",s=".options-column",c=".remove-column",h=".search-term",p=".search-term-holder",l=".refresh-rate",v="#settings-btn",n=6,$(document).ready(function(){return w()}),w=function(){var n,r;return n=new t(e),r=new d(n),$(v).tooltip({placement:"left"}),$(v).click(function(){return r.show()})},d=function(){function e(e){this.analyzer=e,this.nextStreamId=0,this.init()}return e.prototype.init=function(){var e=this;return $(u).modal({backdrop:"static",keyboard:!1,show:!0}),$(i).click(function(){return e.addColumn()}),$(a).click(function(){return e.done()}),this.addColumn()},e.prototype.show=function(){return $(u).modal("show")},e.prototype.hide=function(){return $(u).modal("hide")},e.prototype.addColumn=function(){var e,t=this;return e=$(s).length,e===n?this.addError("There is a maximum of "+n+" columns."):($(o).append('<div class="form-inline options-column">          <div class="control-group search-term-holder">            <input type="text" placeholder="Search term" class="input-medium search-term">           </div>          <div class="control-group">              <div class="input-append">                <input type="text" placeholder="Refresh rate" class="input-small refresh-rate"><span class="add-on">seconds</span>              </div>          </div>          <i class="remove-column icon-remove"></i>        </div>'),$(c).click(function(e){return t.removeColumn(e.target)}))},e.prototype.removeColumn=function(e){var t;return console.log(e),console.log($(e).parent()),t=$(e).parent().data("stream"),console.log(t),t!==void 0&&t.destroy(),$(e).parent().remove()},e.prototype.done=function(){var e,t,n=this;$(f).html(""),t=!1,$(s).each(function(e,r){var i;i=$(r).data("stream");if(i===void 0){i=n.createNewStream(r);if(!i)return n.addError("All fields are required."),t=!0}});if(!t)return this.hide(),e=$(s).length,$(m).each(function(t,n){return $(n).removeClass("column-count1 column-count2 column-count3 column-count4 column-count5 column-count6"),$(n).addClass("column-count"+e)})},e.prototype.addError=function(e){return $(f).append("<div class='alert alert-error'>        <a class='close' data-dismiss='alert' href='#''>Ã—</a>        "+e+"        </div>")},e.prototype.createNewStream=function(e){var t,n,r,i;return $(e).find(".error").each(function(e,t){return $(t).removeClass("error")}),t=!1,r=$(e).find(h).val(),r===""?(t=!0,$(e).find(h).parent().addClass("error")):$(e).find(p).find(".uneditable-input").length<1&&($(e).find(p).append("<span class='input-medium uneditable-input'>"+r+"</span>"),$(e).find(h).hide()),n=$(e).find(l).val(),n===""&&(t=!0,$(e).find(l).parent().parent().addClass("error")),n=parseInt(n)*1e3,t?!1:($(g).append("<div class='stream' id='stream-"+this.nextStreamId+"'>        <h3><i class='icon-search'></i> "+r+"</h3>        <ul class='tweets'>        </ul>      </div>"),i=new y(this.analyzer,r,n,"#stream-"+this.nextStreamId),$(e).data("stream",i),this.nextStreamId++,i)},e}(),y=function(){function e(e,t,n,r){this.searchTerm=t,this.refreshRate=n,this.analyzer=e,this.container=r,this.lastMaxId=0,this.positiveCount=0,this.negativeCount=0,this.neutralCount=0,this.timer=null,this.grabTweets()}return e.prototype.setRefreshRate=function(e){return this.refreshRate=e},e.prototype.destroy=function(){return $(this.container).remove(),clearTimeout(this.timer)},e.prototype.removeOld=function(){return console.log($(this.container).find("li").length),console.log($(this.container).find("li:gt("+r+")").length),$(this.container).find("li:gt("+r+")").remove()},e.prototype.grabTweets=function(){var e=this;return this.removeOld(),$.getJSON("http://search.twitter.com/search.json?callback=?",{q:this.searchTerm,result_type:"recent",lang:"en",since_id:this.lastMaxId,rpp:b},function(t){return e.processTweets(t)})},e.prototype.processTweets=function(e){var t,n,r,i,s=this;if(e.error===void 0){this.lastMaxId=e.max_id_str,i=e.results.reverse();for(n=0,r=i.length;n<r;n++)t=i[n],this.analyzer.addToQueue(t.text,t,function(e,t,n){return s.addToInterface(e,t,n)})}return this.timer=setTimeout(function(){return s.grabTweets()},this.refreshRate)},e.prototype.addToInterface=function(e,t,n){var r,i,s;r=new Date(Date.parse(t.created_at)),s=n>0?"positive":n<0?"negative":"neutral";switch(s){case"positive":this.positiveCount++;break;case"negative":this.negativeCount++;break;case"neutral":this.neutralCount++}return i=$("<li class='tweet "+s+"'>        <div class='title-bar'>          <strong>@"+t.from_user+"</strong>           <em>            <abbr class='timeago' title='"+r.toISOString()+"'>"+r+"</abbr>          </em>          </div>        <img src='"+t.profile_image_url+"' class='avatar'>        "+e+"        <div class='clear'></div>      </li>").hide().prependTo(this.container+" .tweets").slideDown("medium"),$(i).find("abbr.timeago").timeago()},e}()}).call(this);