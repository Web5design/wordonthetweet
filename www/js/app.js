var __t;__t=function(ns){var curr,index,part,parts,_i,_len;curr=null,parts=[].concat=ns.split(".");for(index=_i=0,_len=parts.length;_i<_len;index=++_i){part=parts[index];if(curr===null){curr=eval(part);continue}curr[part]==null?curr=curr[part]={}:curr=curr[part]}return curr};var app={};((function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};__t("app.gui").Stream=function(){function a(a,b,c,d){this.searchTerm=b,this.refreshRate=c,this.analyzer=a,this.container=d,this.lastMaxId=0,this.positiveCount=0,this.negativeCount=0,this.neutralCount=0,this.timer=null,this.grabTweets()}return a.prototype.setRefreshRate=function(a){return this.refreshRate=a},a.prototype.destroy=function(){return $(this.container).remove(),clearTimeout(this.timer)},a.prototype.removeOld=function(){return $(this.container).find("li:gt("+app.Constants.MAX_TWEETS_SHOWN+")").remove()},a.prototype.grabTweets=function(){var a=this;return this.removeOld(),$.getJSON("http://search.twitter.com/search.json?callback=?",{q:this.searchTerm,result_type:"recent",lang:"en",since_id:this.lastMaxId,rpp:app.Constants.TWEETS_PER_PAGE},function(b){return a.processTweets(b)})},a.prototype.processTweets=function(a){var b,c,d,e,f,g=this;if(a.error===void 0){this.lastMaxId=a.max_id_str,f=a.results.reverse();for(d=0,e=f.length;d<e;d++)c=f[d],b=new app.gui.Tweet(c),this.analyzer.addToQueue(b,function(a){return g.addToInterface(a)})}return this.timer=setTimeout(function(){return g.grabTweets()},this.refreshRate)},a.prototype.addToInterface=function(a){var b,c;b=new Date(Date.parse(a.created_at));switch(a.sentiment){case"positive":this.positiveCount++;break;case"negative":this.negativeCount++;break;case"neutral":this.neutralCount++}return c=$("<li class='tweet "+a.sentiment+"'>\n  <div class='title-bar'>\n    <strong>@"+a.username+"</strong> \n    <em>\n      <abbr class='timeago' title='"+b.toISOString()+"'>"+b+"</abbr>\n    </em>\n    </div>\n  <img src='"+a.profile_url+"' class='avatar'>\n  "+a.text+"\n  <div class='clear'></div>\n</li>").hide().prependTo(this.container+" .tweets").slideDown(500),$(c).find("abbr.timeago").timeago()},a}(),__t("app.gui").Tweet=function(){function b(b){this.text=b.text,this.clean_text=a(this.text),b.from_user&&(this.username=b.from_user),b.created_at&&(this.created_at=b.created_at),b.profile_image_url&&(this.profile_url=b.profile_image_url),this.sentiment=b.sentiment?b.sentiment:null}var a;return b.prototype.tokenize=function(){var a,b,c,d,e,f;d=this.clean_text.split(/\s+/g),b=d,a=null;for(e=0,f=d.length;e<f;e++)c=d[e],c!==null&&b.push(""+a+" "+c),a=c;return b},b.prototype.words=function(){return this.clean_text.split(/\s+/g)},a=function(a){var b,c,d,e,f,g,h,i;return a=a.toLowerCase(),g=/&[a-z]+;/g,a=a.replace(g,""),f=/([a-z])'([a-z])/g,a=a.replace(f,"$1$2"),i=/(((f|ht){1}tp(s)?:\/\/)[-a-zA-Z0-9@:%_\+.~?&\/\/=]+)/,a=a.replace(i,""),h=/@[a-z0-9]+|#[a-z0-9]+/g,a=a.replace(h,""),d=/([a-z])([\.,-\/\#!?$%\^&\*;:{}=\-_`"'~()])([a-z ])/g,a=a.replace(d,"$1 $2 $3"),e=/([\.,-\/\#!?$%\^&\*;:{}=\-_`"'~()])([a-z])/g,a=a.replace(e,"$1 $2"),c=/([a-z])([\.,-\/\#!?$%\^&\*;:{}=\-_`"'~()])/g,a=a.replace(c,"$1 $2"),b=/([a-z])\1+/g,a=a.replace(b,"$1"),a=a.trim(),a},b}(),__t("app.classifiers").BagOfWordsClassifier=function(){function a(a){var b=this;this.afinn={},this.queue=[],this.running=!1,this.ready=!1,$.getJSON(a,function(a){return b.afinn=a,b.ready=!0,b.work()})}return a.prototype.addToQueue=function(a,b){this.queue.push({tweet:a,callback:b});if(!this.running&&this.ready)return this.work()},a.prototype.analyze=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;j=a.words(),e=[];for(k=0,m=j.length;k<m;k++)i=j[k],this.afinn[i]!==void 0&&e.push(this.afinn[i]);g=0;for(l=0,n=e.length;l<n;l++)c=e[l],g+=c;return f=Math.sqrt(e.length),h=g/f,d=h>0?"positive":h<0?"negative":"neutral",b(a,d)},a.prototype.work=function(){var a;this.running=!0;while(this.queue.length>0)a=this.queue.shift(),this.analyze(a.tweet,a.callback);return this.running=!1},a}(),__t("app.classifiers").Backend=function(){function a(a){a==null&&(a=null),this.featureCount={},this.categoryCount={},a!==null&&this.loadData(a)}return a.prototype.outputData=function(a){var b,c;return c=this.featureCount,b=this.categoryCount,a({featureCount:c,categoryCount:b})},a.prototype.loadData=function(a){var b=this;return $.getJSON(a,function(a){return b.featureCount=a.featureCount,b.categoryCount=a.categoryCount})},a.prototype.incrementFeature=function(a,b){return this.featureCount[b]==null&&(this.featureCount[b]={}),this.featureCount[b][a]==null&&(this.featureCount[b][a]=0),this.featureCount[b][a]+=1},a.prototype.incrementCategory=function(a){return this.categoryCount[a]==null&&(this.categoryCount[a]=0),this.categoryCount[a]+=1},a.prototype.getFeatureCount=function(a,b){return this.featureCount[b]==null?0:this.featureCount[b][a]==null?0:1*this.featureCount[b][a]},a.prototype.getCategoryCount=function(a){return this.categoryCount[a]==null?0:this.categoryCount[a]},a.prototype.getTotalCount=function(){var a,b,c,d;b=0,d=this.categoryCount;for(a in d)c=d[a],b+=c;return b},a.prototype.getCategories=function(){var a,b,c,d;c=this.categoryCount,d=[];for(a in c)b=c[a],d.push(a);return d},a}(),__t("app.classifiers").Classifier=function(){function a(a){a==null&&(a=null),this.backend=new app.classifiers.Backend(a)}return a.prototype.loadData=function(a){return this.backend.loadData(a)},a.prototype.train=function(a){var b,c,d,e;c=a.tokenize();for(d=0,e=c.length;d<e;d++)b=c[d],this.backend.incrementFeature(b,a.sentiment);return this.backend.incrementCategory(a.sentiment)},a.prototype.getFeatureProbability=function(a,b){var c,d;return c=this.backend.getCategoryCount(b),c===0?0:(d=this.backend.getFeatureCount(a,b),1*d/c)},a.prototype.getWeightedProbability=function(a,b,c){var d,e,f,g,h,i,j;g=1,d=.5,e=c(a,b),f=0,j=this.backend.getCategories();for(h=0,i=j.length;h<i;h++)b=j[h],f+=this.backend.getFeatureCount(a,b);return(g*d+f*e)/(g+f)},a.prototype.outputData=function(a){return this.backend.outputData(a)},a}(),__t("app.classifiers").NaiveBayesClassifier=function(a){function b(a){a==null&&(a=null),b.__super__.constructor.call(this,a),this.thresholds=[]}return c(b,a),b.prototype.loadData=function(a){return b.__super__.loadData.call(this,a)},b.prototype.getProbability=function(a,b){var c,d,e,f,g,h,i,j;c=this.backend.getCategoryCount(b)/this.backend.getTotalCount(),e=a.tokenize(),h=this,f=function(a,b){return h.getFeatureProbability(a,b)},g=1;for(i=0,j=e.length;i<j;i++)d=e[i],g*=this.getWeightedProbability(d,b,f);return g*c},b.prototype.setThreshold=function(a,b){return this.thresholds[a]=b},b.prototype.getThreshold=function(a){return this.thresholds[a]||0},b.prototype.classify=function(a){var b,c,d,e,f,g,h,i;e=[],d=0,b="hi",i=this.backend.getCategories();for(g=0,h=i.length;g<h;g++)c=i[g],e[c]=this.getProbability(a,c),e[c]>d&&(d=e[c],b=c);for(c in e){f=e[c];if(c===b)continue;if(e[c]*this.getThreshold(b)>e[b])return"unknown"}return b},b}(app.classifiers.Classifier),__t("app").Analyzer=function(){function a(){this.bagOfWords=new app.classifiers.BagOfWordsClassifier("data/afinn-111-emo.json"),this.labeledNaiveBayes=new app.classifiers.NaiveBayesClassifier("data/labeled.json"),this.emoticonNaiveBayes=new app.classifiers.NaiveBayesClassifier("data/emoticon.json"),this.queue=[],this.running=!1}return a.prototype.addToQueue=function(a,b){this.queue.push({tweet:a,callback:b});if(!this.running)return this.work()},a.prototype.work=function(){var a,b=this;this.running=!0;while(this.queue.length>0)a=this.queue.shift(),this.bagOfWords.addToQueue(a.tweet,function(c,d){return b.decideBest(c,d,a.callback)});return this.running=!1},a.prototype.decideBest=function(a,b,c){return a.sentiment=b,c(a)},a}(),__t("app").Constants=function(){function a(){}return a.TWEETS_PER_PAGE=20,a.MAX_TWEETS_SHOWN=150,a.AFINN_LOCATION="AFINN-111-emo.txt",a.STREAM_HOLDER="#stream-holder",a.STREAM=".stream",a.OPTIONS_CONTAINER="#options",a.OPTIONS_COLUMNS="#options-columns",a.OPTIONS_ADD_BTN="#options-add-btn",a.OPTIONS_DONE_BTN="#options-done-btn",a.OPTIONS_ERRORS="#options-errors",a.OPTIONS_COLUMN=".options-column",a.OPTIONS_REMOVE_COLUMN=".remove-column",a.OPTIONS_SEARCH_TERM=".search-term",a.OPTIONS_SEARCH_TERM_HOLDER=".search-term-holder",a.OPTIONS_REFRESH_RATE=".refresh-rate",a.SETTINGS_BTN="#settings-btn",a.MAX_COLUMNS=6,a}(),__t("app.gui").Options=function(){function a(a){this.analyzer=a,this.nextStreamId=0,this.init()}return a.prototype.init=function(){var a=this;return $(app.Constants.OPTIONS_CONTAINER).modal({backdrop:"static",keyboard:!1,show:!0}),$(app.Constants.OPTIONS_ADD_BTN).click(function(){return a.addColumn()}),$(app.Constants.OPTIONS_DONE_BTN).click(function(){return a.done()}),this.addColumn()},a.prototype.show=function(){return $(app.Constants.OPTIONS_CONTAINER).modal("show")},a.prototype.hide=function(){return $(app.Constants.OPTIONS_CONTAINER).modal("hide")},a.prototype.addColumn=function(){var a,b=this;return _gaq.push(["_trackEvent","Options","Columns","Add"]),a=$(app.Constants.OPTIONS_COLUMN).length,a===app.Constants.MAX_COLUMNS?this.addError("There is a maximum of "+app.Constants.MAX_COLUMNS+" columns."):($(app.Constants.OPTIONS_COLUMNS).append('<div class="form-inline options-column">\n  <div class="control-group search-term-holder">\n    <input type="text" placeholder="Search term" class="input-medium search-term"> \n  </div>\n  <div class="control-group">\n      <div class="input-append">\n        <input type="text" placeholder="Refresh rate" class="input-small refresh-rate"><span class="add-on">seconds</span>\n      </div>\n  </div>\n  <i class="remove-column icon-remove"></i>\n</div>'),$(app.Constants.OPTIONS_REMOVE_COLUMN).click(function(a){return b.removeColumn(a.target)}))},a.prototype.removeColumn=function(a){var b;return _gaq.push(["_trackEvent","Options","Columns","Remove"]),b=$(a).parent().data("stream"),b!==void 0&&b.destroy(),$(a).parent().remove()},a.prototype.done=function(){var a,b,c=this;return $(app.Constants.OPTIONS_ERRORS).html(""),b=!1,$(app.Constants.OPTIONS_COLUMN).each(function(a,d){var e;e=$(d).data("stream");if(e===void 0){e=c.createNewStream(d);if(!e)return c.addError("All fields are required."),b=!0}}),b?_gaq.push(["_trackEvent","Options","Done","Error"]):(this.hide(),a=$(app.Constants.OPTIONS_COLUMN).length,_gaq.push(["_trackEvent","Options","Done",""+a]),$(app.Constants.STREAM).each(function(b,c){return $(c).removeClass("column-count1 column-count2 column-count3 column-count4 column-count5 column-count6"),$(c).addClass("column-count"+a)}))},a.prototype.addError=function(a){return $(OPTIONS_ERRORS).append("<div class='alert alert-error'>\n<a class='close' data-dismiss='alert' href='#''>×</a>\n"+a+"\n</div>")},a.prototype.createNewStream=function(a){var b,c,d,e;return $(a).find(".error").each(function(a,b){return $(b).removeClass("error")}),b=!1,d=$(a).find(app.Constants.OPTIONS_SEARCH_TERM).val(),d===""&&(b=!0,$(a).find(app.Constants.OPTIONS_SEARCH_TERM).parent().addClass("error")),c=$(a).find(app.Constants.OPTIONS_REFRESH_RATE).val(),c===""&&(b=!0,$(a).find(Oapp.Constants.PTIONS_REFRESH_RATE).parent().parent().addClass("error")),b?!1:(_gaq.push(["_trackEvent","Options","Stream-Term",d]),_gaq.push(["_trackEvent","Options","Stream-Rate",c]),$(a).find(app.Constants.OPTIONS_SEARCH_TERM).hide(),$(a).find(app.Constants.OPTIONS_REFRESH_RATE).parent().hide(),$(a).find(app.Constants.OPTIONS_SEARCH_TERM_HOLDER).append("Search for <strong>"+d+"</strong> every <em>"+c+" seconds</em>"),$(app.Constants.STREAM_HOLDER).append("<div class='stream' id='stream-"+this.nextStreamId+"'>\n  <h3><i class='icon-search'></i> "+d+"</h3>\n  <ul class='tweets'>\n  </ul>\n</div>"),c=parseInt(c)*1e3,e=new app.gui.Stream(this.analyzer,d,c,"#stream-"+this.nextStreamId),$(a).data("stream",e),this.nextStreamId++,e)},a}(),$(document).ready(function(){return a()}),a=function(){var a,b;return a=new app.Analyzer,b=new app.gui.Options(a),$(app.Constants.SETTINGS_BTN).tooltip({placement:"left"}),$(app.Constants.SETTINGS_BTN).click(function(){return b.show()})}})).call(this)