var __t;__t=function(ns){var curr,index,part,parts,_i,_len;curr=null,parts=[].concat=ns.split(".");for(index=_i=0,_len=parts.length;_i<_len;index=++_i){part=parts[index];if(curr===null){curr=eval(part);continue}curr[part]==null?curr=curr[part]={}:curr=curr[part]}return curr};var app={};((function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};__t("app.lib").Classifier=function(){function a(){this.data=null,this.ready=!1}return a.prototype.loadData=function(a){var b=this;return $.getJSON(a,function(a){return b.data=a,b.ready=!0,$(b).trigger(app.lib.Classifier.Events.Ready,b)})},a.prototype.exportData=function(a){return $.post(a,{data:this.data},function(){})},a.prototype.classify=function(){return"Not implemented"},a.Events={Ready:"Classifier.Events.Ready"},a}(),__t("app").Constants=function(){function a(){}return a.TWEETS_PER_PAGE=20,a.MAX_TWEETS_SHOWN=150,a.MAX_COLUMNS=6,a}(),__t("app.controllers").AppController=function(){function a(){this.options_controller=new app.controllers.OptionsController}return a}(),__t("app.controllers").OptionsController=function(){function a(){this.options_model=new app.models.OptionsModel}return a}(),__t("app.controllers").StreamController=function(){function a(){}return a.prototype.grabTweets=function(){var a=this;return this.removeOld(),$.getJSON("http://search.twitter.com/search.json?callback=?",{q:this.searchTerm,result_type:"recent",lang:"en",since_id:this.lastMaxId,rpp:app.Constants.TWEETS_PER_PAGE},function(b){return a.processTweets(b)})},a.prototype.addToInterface=function(a){var b,c;b=new Date(Date.parse(a.created_at));switch(a.sentiment){case"positive":this.positiveCount++;break;case"negative":this.negativeCount++;break;case"neutral":this.neutralCount++}return c=$("<li class='tweet "+a.sentiment+"'>\n  <div class='title-bar'>\n    <strong>@"+a.username+"</strong> \n    <em>\n      <abbr class='timeago' title='"+b.toISOString()+"'>"+b+"</abbr>\n    </em>\n    </div>\n  <img src='"+a.profile_url+"' class='avatar'>\n  "+a.text+"\n  <div class='clear'></div>\n</li>").hide().prependTo(this.container+" .tweets").slideDown(500)},a}(),__t("app.lib").BagOfWordsClassifier=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.classify=function(a){var b,c,d,e,f,g,h,i,j;h=a.words(),e=0,b=0;for(i=0,j=h.length;i<j;i++)g=h[i],this.data[g]!==void 0&&(e+=this.data[g],b++);return d=Math.sqrt(b),f=e/d,c=f>0?"p":f<0?"n":null,[c,f]},c}(app.lib.Classifier),__t("app.lib").NaiveBayesClassifier=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.classify=function(a){var b,c,d,e,f;f=a.tokenize(),e=[],d=0,b=null;for(c in this.data.categoryCount)e[c]=this.getProbability(f,c),e[c]>d&&(d=e[c],b=c);return[b,e[c]]},c.prototype.getProbability=function(a,b){var c,d,e,f,g,h,i=this;c=this.getCategoryCount(b)/this.getTotalCount(),e=function(a,b){return i.getFeatureProbability(a,b)},f=1;for(g=0,h=a.length;g<h;g++)d=a[g],f*=this.getWeightedProbability(d,b,e);return f*c},c.prototype.getFeatureProbability=function(a,b){var c,d;return c=this.getCategoryCount(b),c===0?0:(d=this.getFeatureCount(a,b),1*d/c)},c.prototype.getCategoryCount=function(a){return this.data.categoryCount[a]==null?0:this.data.categoryCount[a]},c.prototype.getFeatureCount=function(a,b){return this.data.featureCount[b]==null?0:this.data.featureCount[b][a]==null?0:1*this.data.featureCount[b][a]},c.prototype.getCategoryCount=function(a){return this.data.categoryCount[a]==null?0:this.data.categoryCount[a]},c.prototype.getTotalCount=function(){var a,b,c,d;b=0,d=this.data.categoryCount;for(a in d)c=d[a],b+=c;return b},c.prototype.getWeightedProbability=function(a,b,c){var d,e,f,g,h,i,j;g=1,d=.5,e=c(a,b),f=0,j=this.getCategories();for(h=0,i=j.length;h<i;h++)b=j[h],f+=this.getFeatureCount(a,b);return(g*d+f*e)/(g+f)},c.prototype.getCategories=function(){var a,b,c,d;c=this.categoryCount,d=[];for(a in c)b=c[a],d.push(a);return d},c}(app.lib.Classifier),__t("app.models").AnalyzerModel=function(){function a(){var a=this;this.ready=!1,this.bag_of_words_classifier=new app.lib.BagOfWordsClassifier,this.bag_of_words_classifier.loadData("data/afinn-111-emo.json"),$(this.bag_of_words_classifier).on(app.lib.Classifier.Events.Ready,function(b,c){return a.checkReady(c)}),this.emoticon_naive_bayes_classifier=new app.lib.NaiveBayesClassifier,this.emoticon_naive_bayes_classifier.loadData("data/emoticon.json"),$(this.emoticon_naive_bayes_classifier).on(app.lib.Classifier.Events.Ready,function(b,c){return a.checkReady(c)}),this.labeled_naive_bayes_classifier=new app.lib.NaiveBayesClassifier,this.labeled_naive_bayes_classifier.loadData("data/labeled.json"),$(this.labeled_naive_bayes_classifier).on(app.lib.Classifier.Events.Ready,function(b,c){return a.checkReady(c)})}return a.prototype.checkReady=function(a){if(this.bag_of_words_classifier.ready&&this.emoticon_naive_bayes_classifier.ready&&this.labeled_naive_bayes_classifier.ready)return $(this).trigger(app.models.AnalyzerModel.Events.Ready,this)},a.Events={Ready:"AnalyzerModel.Events.Ready"},a}(),__t("app.models").OptionsModel=function(){function a(a){var b=this;this.analyzer_model=new app.models.AnalyzerModel,$(this.analyzer_model).on(app.models.AnalyzerModel.Events.Ready,function(a,c){return b.ready()}),this.nextStreamId=0,this.init()}return a.prototype.init=function(){var a=this;return $(app.Constants.OPTIONS_CONTAINER).modal({backdrop:"static",keyboard:!1,show:!0}),$(app.Constants.OPTIONS_ADD_BTN).click(function(){return a.addColumn()}),$(app.Constants.OPTIONS_DONE_BTN).click(function(){return a.done()})},a.prototype.ready=function(){return console.log("everything is Ready")},a.prototype.done=function(){var a,b,c=this;return $(app.Constants.OPTIONS_ERRORS).html(""),b=!1,$(app.Constants.OPTIONS_COLUMN).each(function(a,d){var e;e=$(d).data("stream");if(e===void 0){e=c.createNewStream(d);if(!e)return c.addError("All fields are required."),b=!0}}),b?_gaq.push(["_trackEvent","Options","Done","Error"]):(this.hide(),a=$(app.Constants.OPTIONS_COLUMN).length,_gaq.push(["_trackEvent","Options","Done",""+a]),$(app.Constants.STREAM).each(function(b,c){return $(c).removeClass("column-count1 column-count2 column-count3 column-count4 column-count5 column-count6"),$(c).addClass("column-count"+a)}))},a.prototype.addError=function(a){return $(OPTIONS_ERRORS).append("<div class='alert alert-error'>\n<a class='close' data-dismiss='alert' href='#''>Ã—</a>\n"+a+"\n</div>")},a.prototype.createNewStream=function(a){var b,c,d,e;return $(a).find(".error").each(function(a,b){return $(b).removeClass("error")}),b=!1,d=$(a).find(app.Constants.OPTIONS_SEARCH_TERM).val(),d===""&&(b=!0,$(a).find(app.Constants.OPTIONS_SEARCH_TERM).parent().addClass("error")),c=$(a).find(app.Constants.OPTIONS_REFRESH_RATE).val(),c===""&&(b=!0,$(a).find(Oapp.Constants.PTIONS_REFRESH_RATE).parent().parent().addClass("error")),b?!1:(_gaq.push(["_trackEvent","Options","Stream-Term",d]),_gaq.push(["_trackEvent","Options","Stream-Rate",c]),$(a).find(app.Constants.OPTIONS_SEARCH_TERM).hide(),$(a).find(app.Constants.OPTIONS_REFRESH_RATE).parent().hide(),$(a).find(app.Constants.OPTIONS_SEARCH_TERM_HOLDER).append("Search for <strong>"+d+"</strong> every <em>"+c+" seconds</em>"),$(app.Constants.STREAM_HOLDER).append("<div class='stream' id='stream-"+this.nextStreamId+"'>\n  <h3><i class='icon-search'></i> "+d+"</h3>\n  <ul class='tweets'>\n  </ul>\n</div>"),c=parseInt(c)*1e3,e=new app.gui.Stream(this.analyzer,d,c,"#stream-"+this.nextStreamId),$(a).data("stream",e),this.nextStreamId++,e)},a}(),__t("app.models").StreamModel=function(){function a(a,b){this.searchTerm=a,this.refreshRate=b,this.lastMaxId=0,this.positiveCount=0,this.negativeCount=0,this.neutralCount=0,this.timer=null}return a.prototype.setRefreshRate=function(a){this.refreshRate=a},a.prototype.destroy=function(){return clearTimeout(this.timer)},a.prototype.processTweets=function(a){var b,c,d,e,f,g=this;if(a.error===void 0){this.lastMaxId=a.max_id_str,f=a.results.reverse();for(d=0,e=f.length;d<e;d++)c=f[d],b=new app.gui.Tweet(c),this.analyzer.addToQueue(b,function(a){return g.addToInterface(a)})}return this.timer=setTimeout(function(){return g.grabTweets()},this.refreshRate)},a}(),__t("app.models").TweetModel=function(){function b(b){this.text=b.text,this.clean_text=a(this.text),b.from_user&&(this.username=b.from_user),b.created_at&&(this.created_at=b.created_at),b.profile_image_url&&(this.profile_url=b.profile_image_url),this.sentiment=b.sentiment?b.sentiment:void 0}var a;return b.prototype.tokenize=function(){var a,b,c,d,e,f;d=this.clean_text.split(/\s+/g),b=d,a=void 0;for(e=0,f=d.length;e<f;e++)c=d[e],a!==void 0&&b.push(""+a+" "+c),a=c;return b},b.prototype.words=function(){return this.clean_text.split(/\s+/g)},a=function(a){var b,c,d,e,f,g,h,i;return a=a.toLowerCase(),g=/&[a-z]+;/g,a=a.replace(g,""),f=/([a-z])'([a-z])/g,a=a.replace(f,"$1$2"),i=/(((f|ht){1}tp(s)?:\/\/)[-a-zA-Z0-9@:%_\+.~?&\/\/=]+)/,a=a.replace(i,""),h=/@[a-z0-9]+|#[a-z0-9]+/g,a=a.replace(h,""),d=/([a-z])([\.,-\/\#!?$%\^&\*;:{}=\-_`"'~()])([a-z ])/g,a=a.replace(d,"$1 $2 $3"),e=/([\.,-\/\#!?$%\^&\*;:{}=\-_`"'~()])([a-z])/g,a=a.replace(e,"$1 $2"),c=/([a-z])([\.,-\/\#!?$%\^&\*;:{}=\-_`"'~()])/g,a=a.replace(c,"$1 $2"),b=/([a-z])\1+/g,a=a.replace(b,"$1"),a=a.trim(),a},b}(),__t("app.views").OptionsView=function(){function a(){}return a.prototype.show=function(){return $(app.Constants.OPTIONS_CONTAINER).modal("show")},a.prototype.hide=function(){return $(app.Constants.OPTIONS_CONTAINER).modal("hide")},a.prototype.addColumn=function(){var a,b=this;return _gaq.push(["_trackEvent","Options","Columns","Add"]),a=$(app.Constants.OPTIONS_COLUMN).length,a===app.Constants.MAX_COLUMNS?this.addError("There is a maximum of "+app.Constants.MAX_COLUMNS+" columns."):($(app.Constants.OPTIONS_COLUMNS).append('<div class="form-inline options-column">\n  <div class="control-group search-term-holder">\n    <input type="text" placeholder="Search term" class="input-medium search-term"> \n  </div>\n  <div class="control-group">\n      <div class="input-append">\n        <input type="text" placeholder="Refresh rate" class="input-small refresh-rate"><span class="add-on">seconds</span>\n      </div>\n  </div>\n  <i class="remove-column icon-remove"></i>\n</div>'),$(app.Constants.OPTIONS_REMOVE_COLUMN).click(function(a){return b.removeColumn(a.target)}))},a.prototype.removeColumn=function(a){var b;return _gaq.push(["_trackEvent","Options","Columns","Remove"]),b=$(a).parent().data("stream"),b!==void 0&&b.destroy(),$(a).parent().remove()},a}(),__t("app.views").StreamView=function(){function a(){}return a.prototype.removeOld=function(){return $(this.container).find("li:gt("+app.Constants.MAX_TWEETS_SHOWN+")").remove()},a}(),__t("app.views").TweetView=function(){function b(){}var a;return a=$("<li class='tweet "+tweet.sentiment+"'>\n  <div class='title-bar'>\n    <strong>@"+tweet.username+"</strong> \n    <em>\n      <abbr class='timeago' title='"+date.toISOString()+"'>"+date+"</abbr>\n    </em>\n    </div>\n  <img src='"+tweet.profile_url+"' class='avatar'>\n  "+tweet.text+"\n  <div class='clear'></div>\n</li>"),$(a).find("abbr.timeago").timeago(),b}(),$(document).ready(function(){var a;return a=new app.controllers.AppController})})).call(this)